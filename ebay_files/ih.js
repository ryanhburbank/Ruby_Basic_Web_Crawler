
// 00.01.sleep.js

(function(){var Sleep;Sleep=(function(){Sleep.name='Sleep';function Sleep(){}
Sleep.prototype.sleep=function(retailer_name,seconds){var now_timestamp=new Date().getTime();var sleep_until_timestamp=now_timestamp+(seconds*1000);localStorage.setItem(this.sleepKey(retailer_name),sleep_until_timestamp);};Sleep.prototype.awake=function(retailer_name){localStorage.removeItem(this.sleepKey(retailer_name));}
Sleep.prototype.isSleeping=function(retailer_name){var sleep_until_timestamp=parseInt(localStorage.getItem(this.sleepKey(retailer_name)));if(sleep_until_timestamp){var now_timestamp=new Date().getTime();if(now_timestamp<sleep_until_timestamp){return true;}}
return false;}
Sleep.prototype.sleepKey=function(retailer_name){return"ih-sleep-"+retailer_name;}
return Sleep;})();window.Sleep=Sleep;}).call(this);
// 00.notification_utils.js

(function(){var Url;window.notificationUtils={formatPrice:function(price,currency){var parsedPrice;parsedPrice=parseFloat(price);if(isNaN(parsedPrice)){return'Unknown';}
return currency+notificationUtils.numberWithCommas(parsedPrice.toFixed(2));},formatPnp:function(pnp,currency){var parsedPnp;parsedPnp=parseFloat(pnp);if((isNaN(parsedPnp))||parsedPnp===0){return'Free';}
return currency+notificationUtils.numberWithCommas(parsedPnp.toFixed(2));},currencySymbol:function(currency){var symbol;symbol='';switch(currency){case'USD':return symbol='$';case'GBP':return symbol='£';case'EUR':return symbol='€';default:return symbol='';}},htmlCurrencySymbol:function(currency){var symbol;symbol='';switch(currency){case'USD':return symbol='$';case'GBP':return symbol='&pound;';case'EUR':return symbol='&euro;';default:return symbol='';}},shortenString:function(string,length){if(string.length>length){string=string.substring(0,length)+"...";}
return string;},camelCase:function(string){return string.substring(0,1).toUpperCase()+string.substring(1);},buildUrl:function(path,params){var p,query,v;query=[];for(p in params){v=params[p];query.push(p+"="+escape(v));}
return path+"?"+query.join("&");},numberWithCommas:function(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");}};Url=(function(){Url.name='Url';function Url(path_and_qs){var el,elms,_i,_len,_ref,_ref1;this.path_and_qs=path_and_qs!=null?path_and_qs:location.href;_ref=this.path_and_qs.split('?',2),this.path=_ref[0],this.qs_data=_ref[1];this.query={};_ref1=this.qs_data.split('&');for(_i=0,_len=_ref1.length;_i<_len;_i++){elms=_ref1[_i];el=elms.split('=',2);this.query[el[0]]=el[1];}}
Url.prototype.build=function(){var key,ret,val,_ref;ret=new Array;_ref=this.query;for(key in _ref){val=_ref[key];ret.push(""+key+"="+val);}
return this.path+'?'+ret.join('&');};return Url;})();window.Url=Url;}).call(this);
// 01.api.js

(function(){var API;API=(function(){API.name='API';function API(region,tracking_code,callback){var _this=this;this.region=region;this.tracking_code=tracking_code;this.pb_retailers=[];this.retailers(function(retailers){_this.pb_retailers=retailers.coupon_retailers;return callback();});}
API.prototype.alternatives=function(url,scrape,alternativeCallback,pageCallback){var params;params={url:url,scrape:JSON.stringify(scrape),region:this.region.code,tracking_code:this.tracking_code};return $.getJSON('/alternatives',params,function(data){var alt,_i,_len,_ref;_ref=data.alternatives;for(_i=0,_len=_ref.length;_i<_len;_i++){alt=_ref[_i];alternativeCallback(alt,data.product);}
return pageCallback(data.page,data.product);});};API.prototype.updatePrice=function(url,price){var params;return params={url:url,region:this.region.code,tracking_code:this.tracking_code,price:price};};API.prototype.reviews=function(url,reviewsCallback){var params;params={url:url,region:this.region.code,tracking_code:this.tracking_code};return $.getJSON('/reviews',params,function(reviews){return reviewsCallback(reviews);});};API.prototype.relatedProducts=function(url,callback){var params;params={url:url,region:this.region.code,tracking_code:this.tracking_code};return $.getJSON('/related_products',params,function(relateds){return callback(relateds);});};API.prototype.coupons=function(retailer_id,uid,callback){var params;params={rid:retailer_id,ver:'4.0',partnerid:'1',code:'1',uid:uid};return $.getJSON('https://tb.invisiblehandlabs.com/coupons.php',params,function(coupons){return callback(coupons);});};API.prototype.retailers=function(callback){return $.getJSON('https://tb.invisiblehandlabs.com/ih/coupon_retailers.php',{},function(retailers){return callback(retailers);});};return API;})();window.API=API;}).call(this);
// 01a.flubit.js

(function(){var Flubit,__bind=function(fn,me){return function(){return fn.apply(me,arguments);};};Flubit=(function(){Flubit.name='Flubit';function Flubit(url,asin,title,price,pnp){this.url=url;this.asin=asin;this.title=title;this.price=price;this.pnp=pnp;this.forgottenPassword=__bind(this.forgottenPassword,this);this.checkStock=__bind(this.checkStock,this);this.stockFound=false;this.eventsBound=false;if(this.url.match(/amazon\.co\.uk/)&&this.asin){this.checkStock(this.asin);}}
Flubit.prototype.shouldShow=function(){return this.stockFound;};Flubit.prototype.checkStock=function(asin){var params,_this=this;params={asin:asin,price:this.price};return $.getJSON('/flubit/has_stock',params,function(data){if(data&&data.stock&&data.product_id){_this.stockFound=data.stock>0;_this.flubitProductId=data.product_id;}
if(_this.stockFound){return window.ih.notification.show();}});};Flubit.prototype.createDemand=function(success,error){var jqXhr,params;params={url:this.url,pnp:this.pnp,price:this.price,title:this.title,quantity:1,email:this.userEmail,password:this.password,product_id:this.flubitProductId};jqXhr=$.post('/flubit/new_demand',params,success);return jqXhr.fail(error);};Flubit.prototype.forgottenPassword=function(email){var params,_this=this;params={email_address:email};$('#flubit-popup .forgotten-password').text("Sending password recovery...");return $.getJSON('/flubit/forgotten_password',params,function(data){return $('#flubit-popup #forgotten-password').text("A password recovery email has been sent.");});};Flubit.prototype.show_button=function(status){$('#flubit-product-title').text(this.title);switch(status){case true:$('#flubit:hidden').css('display','inline-block');break;case false:$('#flubit').hide();}
if(!this.eventsBound){return this.bindEvents();}};Flubit.prototype.bindEvents=function(){var _this=this;$('#flubit-popup .close-link').click(function(){return $('#flubit-input').blur();});$('#flubit-popup .forgotten-password').click(function(){var userEmail;userEmail=$('#flubit-form .user-email').val();if(userEmail.match(/^.+@.+\..+$/)){$('#flubit-popup .user-email-error').fadeOut();return _this.forgottenPassword(userEmail);}else{return $('#flubit-popup .user-email-error').fadeIn();}});$("input.user-email, input.password").keypress(function(event){if(event.which===13){event.preventDefault();return _this.processForm();}});$('.go-button').click(function(){return _this.processForm();});$('#what_is_flubit_link').click(function(){return $('#what_is_flubit').animate({height:'toggle',opacity:'toggle'},'slow');});return this.eventsBound=true;};Flubit.prototype.processForm=function(){var error,success;this.userEmail=$('#flubit-form .user-email').val();this.password=$('#flubit-form .password').val();if(!this.userEmail.match(/^.+@.+\..+$/)){return $('#flubit-popup .user-email-error').fadeIn();}else if(this.password.length<6){$('#flubit-popup .user-email-error').fadeOut();return $('#flubit-popup .password-error').fadeIn();}else{$('#flubit-popup .user-email-error').fadeOut();$('#flubit-popup .password-error').fadeOut();$(".flubit-user-email").text(this.userEmail);$('#flubit-form').hide();$('#flubit-popup .waiting').removeClass("hidden").show();success=function(data){var errorString;$('#flubit-popup .waiting').hide();if(data.status==="success"){$('#flubit-popup .check-demand').attr('href',"http://www.ﬂubit.com/#!Demand/Detail/demand_id="+data.demand_id);$('#flubit-acknowledge').removeClass("hidden").show();return window.ih.reporter.trackFlubitDemandCreated(this.url,this.asin);}else{$('#flubit-form').show();$('#flubit-popup .demand-failed').fadeIn();if(data.error_message){errorString=data.error_message[data.error_message.length-1];if(errorString.match(/Demand limit reached for the day/)){return $('#flubit-popup .demand-failed .error').text("Unfortunately, you've reached your demand limit for today.");}else if(errorString.match(/Incorrect password/)){return $('#flubit-popup .demand-failed .error').text("You already have an account, please enter your correct password.");}else{return $('#flubit-popup .demand-failed .error').text(errorString);}}}};error=function(xhr){$('#flubit-popup .waiting').hide();return $('#flubit-popup .demand-error').removeClass("hidden").show();};return this.createDemand(success,error);}};return Flubit;})();window.Flubit=Flubit;}).call(this);
// 02.01.coupons.js

(function(){var Coupons;Coupons=(function(){Coupons.name='Coupons';function Coupons(region,retailer,uid){this.uid=uid;this.region=region;this.retailer=retailer;this.retailer_id=this.getRetailerId(retailer);this.coupons_arr=[];}
Coupons.prototype.getRetailerId=function(url){var retailers=window.ih.api.pb_retailers;for(var i=0;i<retailers.length;i++){if(retailers[i].name.toLowerCase().replace('www.','').indexOf(url.toLowerCase())==0){return retailers[i].id;}}
return 0;}
Coupons.prototype.fetch=function(){var _this=this;var callback=function(response){var coupons=response[0].coupons;if(coupons.length>0){$('#coupons:hidden').css('display','inline-block');for(var i=0;i<coupons.length;i++){var e=$('#coupon-row-template').clone();var a=e.find('a');e.appendTo('#coupons-list').addClass('coupon-row').removeAttr('id');var url=coupons[i].url;var label=coupons[i].label;var code=coupons[i].code;if(code!=undefined){var code_element=e.find('.coupon-code');code_element.attr("id","coupon-code"+i);a.removeAttr("target");a.click(function(){window.ih.extension.notify('backgroundLink',{url:url});$(this).next().css('display','block');});code_element.text('Use Code: '+code);}else{a.attr('href',url);}
_this.coupons_arr.push({'url':url,'label':label});$('.coupon-label',e).html(label);}
if(coupons[0]!=null&&coupons[0].featured!=null)
$('#placeholder > div').text(coupons[0].label);else
$('#placeholder > div').text('InvisibleHand has found '+_this.some()+" "+response[0].retailer.name+' coupons');window.ih.notification.show_pb();}}
window.ih.api.coupons(this.retailer_id,this.uid,callback);}
Coupons.prototype.some=function(){return this.coupons_arr.length;}
return Coupons;})();window.Coupons=Coupons;}).call(this);
// 02.related_products.js

(function(){var RelatedProducts;RelatedProducts=(function(){RelatedProducts.name='RelatedProducts';function RelatedProducts(url,region,retailer){this.url=url;this.region=region;this.retailer=retailer;this.relatedProducts=[];}
RelatedProducts.prototype.initialize=function(msg){this.relatedProducts=msg.related_products;if(this.relatedProducts&&this.relatedProducts.length>0){return this.show();}};RelatedProducts.prototype.some=function(){return this.relatedProducts&&this.relatedProducts.length>0;};RelatedProducts.prototype.size=function(){return this.relatedProducts.length;};RelatedProducts.prototype.clear=function(){return $('.relateditems-row').remove();};RelatedProducts.prototype.show=function(){var element,relatedProduct,url,_i,_len,_ref,_results;this.clear();$('#tabs li .relateditems').text("Related Items").addClass("enabled");$("#tabs").tabs("enable","#related-items");$("#tabs").tabs("select","#related-items");if(!$('#tabs li .reviews').hasClass("enabled")){$("#tabs").tabs("disable","#reviews");}
$("#more").css('display','inline-block');_ref=this.relatedProducts;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){relatedProduct=_ref[_i];if(relatedProduct.best_page){element=$('#relateditems-table #relateditems-row-template').clone().addClass('relateditems-row').removeClass('template').removeAttr('id').appendTo('#relateditems-table');url=this.retailer===relatedProduct.best_page.retailer_name?relatedProduct.best_page.original_url:relatedProduct.best_page.deeplink;$(element).attr('href',ih.reporter.clickUrl("product_similar_click",url,relatedProduct.best_page.retailer_name));$('.title',element).html(notificationUtils.shortenString(relatedProduct.title,80));$('.retailer',element).html(relatedProduct.best_page.retailer_name);$('.image',element).attr('src',relatedProduct.image_url);_results.push($('.price',element).html(notificationUtils.formatPrice(relatedProduct.best_page.price,notificationUtils.htmlCurrencySymbol(this.region.currency.name))));}else{_results.push(void 0);}}
return _results;};return RelatedProducts;})();window.RelatedProducts=RelatedProducts;}).call(this);
// 03.reviews.js

(function(){var Reviews;Reviews=(function(){Reviews.name='Reviews';function Reviews(url,region,retailer){this.url=url;this.region=region;this.retailer=retailer;this.amazonDomain=this.findAmazonDomain();}
Reviews.prototype.initialize=function(msg){if(msg.summary&&msg.reviews&&msg.asin){this.overallStars=msg.summary.overall_stars;this.histogram=msg.summary.histogram;this.asin=msg.asin;this.userReviews=msg.reviews;return this.show();}};Reviews.prototype.findAmazonDomain=function(){switch(this.region.code){case"US":return"amazon.com";case"UK":return"amazon.co.uk";case"DE":return"amazon.de";case"CA":return"amazon.ca";}};Reviews.prototype.clear=function(){$('.reviews-row').remove();return $('.histogram-table-row').remove();};Reviews.prototype.show=function(){this.clear();$('#tabs li .reviews').text("Reviews").addClass("enabled");$("#tabs").tabs("enable","#reviews");if(!$('#tabs li .relateditems').hasClass("enabled")){$("#tabs").tabs("select","#reviews");$("#tabs").tabs("disable","#related-items");}
this.updateReviewsSnippets();this.updateReviewsHistogram();this.updateAllReviewsLink();return $("#more").css('display','inline-block');};Reviews.prototype.buildSpecificReviewsLink=function(starCount){var affiliateTag,starCountWord,url;affiliateTag=this.amazonAffiliateTag();starCountWord=['One','Two','Three','Four','Five'][starCount-1];url="http://www."+this.amazonDomain+"/product-reviews/"+this.asin+"?filterBy=add"+starCountWord+"Star";if(affiliateTag){url+="&tag="+affiliateTag;}
return ih.reporter.clickUrl("product_review_click",url,this.amazonDomain);};Reviews.prototype.updateAllReviewsLink=function(){var affiliateTag,url;affiliateTag=this.amazonAffiliateTag();url="http://www."+this.amazonDomain+'/-/dp/'+this.asin;if(affiliateTag){url+="?tag="+affiliateTag;}
url+='#customerReviews';return $('#all-reviews-link').attr('href',ih.reporter.clickUrl("product_review_click",url,this.amazonDomain));};Reviews.prototype.isOnAmazonPage=function(){return/^amazon\./.test(this.retailer.toLowerCase());};Reviews.prototype.amazonAffiliateTag=function(){var tracking;if(this.isOnAmazonPage()){return null;}
tracking=$('#tracking-data .amazon_codes .'+this.region.code.toLowerCase()).text();if(tracking){return tracking;}
if(this.amazonDomain==='amazon.com'){return'invihand-20';}
if(this.amazonDomain==='amazon.co.uk'){return'invihand-21';}
if(this.amazonDomain==='amazon.de'){return'invisi08-21';}};Reviews.prototype.updateReviewsSnippets=function(){var element,r,_i,_len,_ref,_results;_ref=this.userReviews;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){r=_ref[_i];element=$('#reviews-row-template').clone().appendTo('#reviews-table').addClass('reviews-row').removeClass('template').removeAttr('id');$('.title',element).html(r.title);$('.text',element).html(notificationUtils.shortenString(r.description,200));_results.push($('.sprite',element).addClass('s_star_'+r.stars+'_0'));}
return _results;};Reviews.prototype.updateReviewsHistogram=function(){var index,maxStars,_i,_results,_this=this;maxStars=5;_results=[];for(index=_i=5;_i>=1;index=--_i){_results.push((function(index){var element,link,starCount;starCount=_this.histogram[index].reviews;element=$('#reviews-histogram .template').clone().css('display','block').appendTo('#reviews-histogram tbody').removeClass('template').addClass("histogram-table-row");$('.stars-count',element).text('('+starCount+')');$('.stars-number',element).text(index+' stars');link=index>0?_this.buildSpecificReviewsLink(index):null;$('.histogram_row_content',element).css('width',_this.histogram[index].percent);if(link){return $('a.stars-number',element).attr('href',link);}else{return $('a.stars-number',element).removeAttr('href');}})(index));}
return _results;};return Reviews;})();window.Reviews=Reviews;}).call(this);
// 04.alternatives.js

(function(){var Alternative,Alternatives;Alternatives=(function(){Alternatives.name='Alternatives';function Alternatives(region,uid){this.region=region;this.uid=uid;this.alternatives={};this.gotResponse=false;}
Alternatives.prototype.fetch=function(url,scrape){var alternativeCallback,pageCallback,_this=this;alternativeCallback=function(alternative,product){_this.add(new Alternative(alternative,_this.region,_this.uid,product));return _this.show();};pageCallback=function(page,product){_this.gotResponse=true;_this.product=product;window.ih.notification.updateProduct(product);if(page){return window.ih.notification.updateCurrentPage(page);}};return window.ih.api.alternatives(url,scrape,alternativeCallback,pageCallback);};Alternatives.prototype.toAttributes=function(){var alternative,url,_ref,_results;_ref=this.alternatives;_results=[];for(url in _ref){alternative=_ref[url];_results.push(alternative.toAttributes());}
return _results;};Alternatives.prototype.show=function(){var alt,alternativesElement,append,i,_i,_len,_ref;if(this.none()){return;}
window.ih.notification.show();alternativesElement=$('#retailers-popup #alternatives');$('.alternative-row',alternativesElement).remove();append=function(alt,i){alt.position=i+1;alt.updateElement();return alternativesElement.append(alt.element);};_ref=this.sorted();for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){alt=_ref[i];append(alt,i);}
$('#results:hidden').css('display','inline-block');$('#alternatives-product-title').html(this.best().title);$('#retailers-content .retailers-text').text("Compare Prices ("+this.size()+")");return $("a.alternative-row").click(function(){window.ih.notification.sendTracking();return true;});};Alternatives.prototype.add=function(alternative){this.alternatives[alternative.originalUrl]=alternative;return this.show();};Alternatives.prototype.update=function(url,scrape){this.alternatives[url].updatePrice(scrape.price);this.show();return window.ih.api.updatePrice(url,scrape.price);};Alternatives.prototype.some=function(){return!this.none();};Alternatives.prototype.none=function(){return!this.valid().length;};Alternatives.prototype.sorted=function(){return this.valid().sort(function(a,b){return a.price-b.price;});};Alternatives.prototype.valid=function(){var alt,url,valid,_ref;valid=[];_ref=this.alternatives;for(url in _ref){alt=_ref[url];if(alt.valid()){valid.push(alt);}}
return valid;};Alternatives.prototype.all=function(){var alt,url,_ref,_results;_ref=this.alternatives;_results=[];for(url in _ref){alt=_ref[url];_results.push(alt);}
return _results;};Alternatives.prototype.best=function(){if(this.some()){return this.sorted()[0];}else{return null;}};Alternatives.prototype.size=function(){return this.valid().length;};Alternatives.prototype.finished=function(){var alt,url;if(this.alternatives.length>0){return((function(){var _ref,_results;_ref=this.alternatives;_results=[];for(url in _ref){alt=_ref[url];_results.push(alt);}
return _results;}).call(this)).reduce(function(fin,alt){return fin&&alt.finished;});}else{return this.gotResponse;}};return Alternatives;})();Alternative=(function(){Alternative.name='Alternative';function Alternative(data,region,uid,product){this.region=region;this.uid=uid;this.product=product;this.title=data.title;this.price=data.price;this.pnp=data.pnp;this.priceConfidence=data.price_confidence;this.retailer=data.retailer_name;this.originalUrl=data.original_url;this.deeplink=data.deeplink;this.imageUrl=data.image_url;this.position=null;this.finished=false;window.ih.extension.notify("scrape",{url:this.originalUrl});this.show();}
Alternative.prototype.valid=function(){return this.priceConfidence==="high"&&this.price!==null&&this.price>0;};Alternative.prototype.formattedPrice=function(){return notificationUtils.formatPrice(this.price,notificationUtils.htmlCurrencySymbol(this.region.currency.name));};Alternative.prototype.formattedPnp=function(){return notificationUtils.formatPnp(this.pnp,notificationUtils.htmlCurrencySymbol(this.region.currency.name));};Alternative.prototype.updatePrice=function(price){var newPrice;this.finished=true;newPrice=parseFloat(price);if(newPrice>0){this.price=newPrice;this.priceConfidence="high";}
return this.show();};Alternative.prototype.show=function(){if(!this.element){this.createElement();}
if(this.valid()){this.updateElement();return this.element.removeClass("hidden");}else{return this.hide();}};Alternative.prototype.hide=function(){if(this.element){return this.element.addClass("hidden");}};Alternative.prototype.getTitle=function(){var t;t=this.title?this.title:"This item";return notificationUtils.shortenString(t,40);};Alternative.prototype.updateElement=function(){var percentagePriceDifference;percentagePriceDifference=ih.notification.relativeSavings(this);if(percentagePriceDifference===0){$('.alternative-row-left .savings-circle .savings-percentage',this.element).html("<span class='percentage-same-text'><small><p>Same</p><p>Price</p></small></span>");$('.alternative-row-left .savings-circle',this.element).addClass('same').removeClass("more").removeClass("less");$('.alternative-row-left',this.element).css('display','table-cell');_gaq.push(['_trackEvent','alternative','same']);}else if(percentagePriceDifference>0){$('.alternative-row-left .savings-circle .savings-percentage',this.element).html("<span class='percentage-save-text'><small>Save</small><br />"+percentagePriceDifference+"%</span>");$('.alternative-row-left .savings-circle',this.element).addClass('less').removeClass("more").removeClass("same");$('.alternative-row-left',this.element).css('display','table-cell');_gaq.push(['_trackEvent','alternative','less']);}else if(percentagePriceDifference<0){$('.alternative-row-left .savings-circle .savings-percentage',this.element).html("<span class='percentage-more-text'>"+(percentagePriceDifference*-1)+"%<br /><small>More</small></span>");$('.alternative-row-left .savings-circle',this.element).addClass('more').removeClass("less").removeClass("same");$('.alternative-row-left',this.element).css('display','table-cell');_gaq.push(['_trackEvent','alternative','more']);}else{$('.alternative-row-left',this.element).css('display','none');_gaq.push(['_trackEvent','alternative','none']);}
$('.alternative-row-middle .price',this.element).html(this.formattedPrice());$('.alternative-row-middle .pnp-value',this.element).html(this.formattedPnp());$('.alternative-row-right .title',this.element).html(this.retailer);$('.alternative-row-right .description',this.element).html(this.title);this.element.attr('href',ih.reporter.alternativeClickUrl(this,this.product));if(this.retailer.match(/^Ebay\./)){$(".ebay",this.element).show();}
return _gaq.push(['_trackEvent','alternative','count']);};Alternative.prototype.createElement=function(){if(this.url===ih.notification.url){return;}
this.element=$('#alternative-row-template').clone().addClass('alternative-row').addClass('retailer-link').removeAttr('id');return this.element;};Alternative.prototype.toAttributes=function(){return{title:this.title,price:this.price,pnp:this.pnp,priceConfidence:this.priceConfidence,retailer:this.retailer,originalUrl:this.originalUrl,deeplink:this.deeplink,imageUrl:this.imageUrl,position:this.position};};return Alternative;})();window.Alternatives=Alternatives;}).call(this);
// 07.sharing.js

SharingArea=function(){this.windowOpenParams='location=no,toolbar=no,menubar=no,status=no,width=600,height=410';this.a={};this.initialized=false;this.currency='';}
SharingArea.prototype={title:function(){if(!this.a.title)return'a product';return this.a.title;},update:function(a,currency){this.a=a;this.currency=notificationUtils.currencySymbol(currency)
if(!this.initialized){this.initialized=true;this.initialize();}},initialize:function(){this.updateShareViaEmail();this.updateShareWithTwitter();this.updateShareViaFacebook();},updateShareViaFacebook:function(){var that=this;$('#share .icon.facebook').click(function(){var url='/share_deal/facebook?message= '+that.shareDealOnFacebookMessage();window.open(that.addUrlAndDeeplinkParameters(url),'ShareTheDeal',that.windowOpenParams);if(ih.reporter)ih.reporter.trackShareClick('facebook',ih.notification.bestOverallAlternative().retailer);return false;});},addUrlAndDeeplinkParameters:function(url){if(this.a.url)url=url+'&url='+escape(this.a.url);if(this.a.deeplink)url=url+'&deeplink='+escape(this.a.deeplink);return url;},shareDealOnFacebookMessage:function(){return'Just used '+$("#brand .name").text()+' '+$("#brand .shortened_url").text()+' and found '+this.title()+' for only '+notificationUtils.formatPrice(this.a.price,this.currency)+'! ';},shareOnFaceBookLink:function(message){var facebook_url='https://www.facebook.com/connect/prompt_feed.php?message=';return facebook_url+message;},updateShareViaEmail:function(){var that=this;$('#share .email').click(function(){var url="/share_deal/email?product="+escape(that.title())+"&price="+encodeURIComponent(notificationUtils.formatPrice(that.a.price,that.currency));window.open(that.addUrlAndDeeplinkParameters(url),'ShareTheDeal',that.windowOpenParams);if(ih.reporter)ih.reporter.trackShareClick('email');return false;});},updateShareWithTwitter:function(){var that=this;$('#share .icon.twitter').click(function(){var url="/share_deal/twitter?text="+escape(that.shareWithTwitterText())
window.open(that.addUrlAndDeeplinkParameters(url),'ShareTheDeal',that.windowOpenParams);if(ih.reporter)ih.reporter.trackShareClick('twitter');return false;});},shareWithTwitterText:function(){return"Just used "+$("#brand .name").text()
+" "+$("#brand .shortened_url").text()+" and found "
+notificationUtils.shortenString(this.title(),40).replace(/^\s+/,"")
+" for only "+unescape(encodeURIComponent(notificationUtils.formatPrice(this.a.price,this.currency)))+"!";}}
// 08.gaq.js

var _gaq=_gaq||[];_gaq.push(['_setAccount','UA-21876973-1']);_gaq.push(['_trackPageview']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();
// 09.reporting.js

(function(){var Reporting;Reporting=(function(){Reporting.name='Reporting';function Reporting(message){this.message=message;this.defaultParams={uid:this.message.reporting.uid,page:this.message.url,region:this.message.region.code,src:this.message.reporting.src||this.message.reporting.source,retailer_category:this.retailerType(this.message.reporting.category),retailer_from:this.message.reporting.retailer_name,page_view_id:ih.notification.notificationId,browser:this.message.reporting.browser,extension:this.message.reporting.extension};}
Reporting.prototype.trackUserEvent=function(event,properties,opts){var props;if(properties==null){properties={};}
if(opts==null){opts={};}
props={};$.extend(props,this.defaultParams,properties);return this.trackEvent(event,props,opts);};Reporting.prototype.trackEvent=function(event,properties,opts){var props;if(properties==null){properties={};}
if(opts==null){opts={};}
props={event:event,properties:JSON.stringify(properties)};opts.type='POST';opts.data=props;return $.ajax('/track_event',opts);};Reporting.prototype.retailerType=function(category){if(category==="generic"){return"generic";}
if(category==="search_engine"){return"partner";}else{return"retail";}};Reporting.prototype.trackSimilarProductNotificationShown=function(){return this.trackUserEvent("product_similar_notification");};Reporting.prototype.clickUrl=function(event,deeplink,retailerTo,params){var data,defaultClickParams,firefoxAndAdblock,path,props;if(params==null){params={};}
firefoxAndAdblock=$.browser.mozilla&&window.ADS_BLOCKED;path=firefoxAndAdblock?"/click2":"/click";defaultClickParams={retailer_to:retailerTo};props={};$.extend(props,this.defaultParams,defaultClickParams,params);data={event:event,properties:JSON.stringify(props),alternative:deeplink};return notificationUtils.buildUrl(path,data);};Reporting.prototype.alternativeClickUrl=function(alternative,product,pos){var params,position;position=pos!==void 0?pos:alternative.position;params={alternative_url:alternative.originalUrl,position:position,savings:parseFloat(ih.notification.savings(alternative)),savings_relative:parseFloat(ih.notification.relativeSavings(alternative))};if(product){params.product_id=product.id;}
return this.clickUrl("product_click",alternative.deeplink,alternative.retailer,params);};Reporting.prototype.trackShareClick=function(type,retailerTo){var params;params={retailer_to:retailerTo,share_type:type};return this.trackUserEvent("product_share_click",params);};Reporting.prototype.trackClose=function(){return this.trackUserEvent("product_close");};Reporting.prototype.trackProductNotification=function(){var params;params=this.message.scrape;return this.trackUserEvent("product_notification",params);};Reporting.prototype.trackFinalisedProductNotification=function(normalizedUrl,price,alternatives,product,relatedProducts,flubit_button_shown){var alt,cheapestAlternative,i,params,retailers,_i,_len,_ref;params={normalized_url:normalizedUrl,number_of_alternatives_shown:alternatives.size(),number_of_alternatives_provided:alternatives.all().length};if(product){params.product_id=product.id;}
if(price>0){cheapestAlternative=alternatives.best();params.price=price;params.savings=parseFloat(ih.notification.savings(cheapestAlternative));params.savings_percent=parseFloat(ih.notification.relativeSavings(cheapestAlternative));}
retailers=[];_ref=alternatives.sorted();for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){alt=_ref[i];if(i<10){params["alternative_"+(i+1)+"_price"]=alt.price;params["alternative_"+(i+1)+"_retailer"]=alt.retailer;}
retailers.push(alt.retailer);}
params.alternative_retailers=retailers.join(",");if(relatedProducts&&relatedProducts.size()>0){params.number_of_related_products=relatedProducts.size();}
params.flubit_button_shown=flubit_button_shown;return this.trackUserEvent("product_notification_finished",params,{async:false});};Reporting.prototype.trackFlubitNotification=function(url,asin){var params;params={url:url,asin:asin};return this.trackUserEvent("flubit_notification",params);};Reporting.prototype.trackFlubitDemandCreated=function(url,asin){var params;params={url:url,asin:asin};return this.trackUserEvent("flubit_demand_created",params);};return Reporting;})();window.Reporting=Reporting;}).call(this);
// 10.uuid.js

uuid=(function(){var BufferClass=typeof(Buffer)=='function'?Buffer:Array;var _buf=new BufferClass(16);var toString=[];var toNumber={};for(var i=0;i<256;i++){toString[i]=(i+0x100).toString(16).substr(1);toNumber[toString[i]]=i;}
function parse(s){var buf=new BufferClass(16);var i=0;s.toLowerCase().replace(/[0-9a-f][0-9a-f]/g,function(octet){buf[i++]=toNumber[octet];});return buf;}
function unparse(buf){var tos=toString,b=buf;return tos[b[0]]+tos[b[1]]+tos[b[2]]+tos[b[3]]+'-'+
tos[b[4]]+tos[b[5]]+'-'+
tos[b[6]]+tos[b[7]]+'-'+
tos[b[8]]+tos[b[9]]+'-'+
tos[b[10]]+tos[b[11]]+tos[b[12]]+
tos[b[13]]+tos[b[14]]+tos[b[15]];}
var ff=0xff;var useCrypto=this.crypto&&crypto.getRandomValues;var rnds=useCrypto?new Uint32Array(4):new Array(4);function uuid(fmt,buf,offset){var b=fmt!='binary'?_buf:(buf?buf:new BufferClass(16));var i=buf&&offset||0;if(useCrypto){crypto.getRandomValues(rnds);}else{rnds[0]=Math.random()*0x100000000;rnds[1]=Math.random()*0x100000000;rnds[2]=Math.random()*0x100000000;rnds[3]=Math.random()*0x100000000;}
var r=rnds[0];b[i++]=r&ff;b[i++]=r>>>8&ff;b[i++]=r>>>16&ff;b[i++]=r>>>24&ff;r=rnds[1];b[i++]=r&ff;b[i++]=r>>>8&ff;b[i++]=r>>>16&0x0f|0x40;b[i++]=r>>>24&ff;r=rnds[2];b[i++]=r&0x3f|0x80;b[i++]=r>>>8&ff;b[i++]=r>>>16&ff;b[i++]=r>>>24&ff;r=rnds[3];b[i++]=r&ff;b[i++]=r>>>8&ff;b[i++]=r>>>16&ff;b[i++]=r>>>24&ff;return fmt===undefined?unparse(b):b;}
uuid.parse=parse;uuid.unparse=unparse;uuid.BufferClass=BufferClass;return uuid;})();
// 11.browser_detect.js

var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS";},searchString:function(data){for(var i=0;i<data.length;i++){var dataString=data[i].string;var dataProp=data[i].prop;this.versionSearchString=data[i].versionSearch||data[i].identity;if(dataString){if(dataString.indexOf(data[i].subString)!=-1)
return data[i].identity;}
else if(dataProp)
return data[i].identity;}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index==-1)return;return parseFloat(dataString.substring(index+this.versionSearchString.length+1));},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init();
// 12.extension.js

(function(){var Extension;$(function(){return window.ih.extension=new Extension;});Extension=(function(){Extension.name='Extension';function Extension(){var func,_this=this;func=function(evt){return _this.receiveMessage(evt);};if(window.addEventListener){window.addEventListener("message",func,false);}else if(window.attachEvent){window.attachEvent("onmessage",func);}}
Extension.prototype.receiveMessage=function(evt){var message;try{message=JSON.parse(evt.data);return this.handleMessage(message);}catch(e){}};Extension.prototype.handleMessage=function(message){if(message.type){return Extension.messageHandlers[message.type](message);}};Extension.messageHandlers={"initialize":function(message){var tracking_code;tracking_code=new Url(window.location.href).query.tracking_code;return window.ih.api=new API(message.region,tracking_code,function(){window.ih.notification=new Notification(message,message.reporting.uid);window.ih.reporter=new Reporting(message);if(message.bclass){return $("body").addClass(message.bclass);}});},"scrapeResult":function(message){return window.ih.notification.updateAlternative(message.url,message.scrape);}};Extension.prototype.notify=function(type,msg){var message;if(msg==null){msg={};}
message=msg;message.type=type;return window.parent.postMessage(JSON.stringify(message),'*');};return Extension;})();}).call(this);
// 13.notification.js

(function(){var Notification;Notification=(function(){Notification.name='Notification';function Notification(page,uid){var browser;this.uid=uid;this.url=page.url;this.retailer=page.reporting.retailer_name;this.scrape=page.scrape;this.region=page.region;this.rootElement=$("#notification");this.iFrameExpansionCounter=0;this.alternatives=new Alternatives(this.region,this.uid);this.alternatives.fetch(this.url,this.scrape);this.sharingArea=new SharingArea();this.relatedProducts=new RelatedProducts(this.url,this.region,this.retailer);this.reviews=new Reviews(this.url,this.region,this.retailer);this.coupons=new Coupons(this.region,this.retailer,this.uid);this.coupons.fetch();this.sleep=new Sleep();this.shown=false;browser=BrowserDetect.browser;this.notificationId=uuid()+browser+this.uid;this.trackingSent=false;this.flubit=new Flubit(this.url,this.scrape.identifier,this.scrape.title,this.scrape.price,this.scrape.pnp);window.ih.api.updatePrice(this.url,this.scrape.price);this.notification_type='normal';this.flubit_button_shown=false;}
Notification.prototype.updateCurrentPage=function(page){this.normalizedUrl=page.original_url;if(!this.scrape.price){this.scrape.price=page.price;}
return this.show();};Notification.prototype.updateAlternative=function(url,scrape){this.alternatives.update(url,scrape);this.show();if(this.alternatives.finished()){return this.sendTracking();}};Notification.prototype.updateProduct=function(product){return this.product=product;};Notification.prototype.sendTracking=function(){if(this.shown&&!this.trackingSent){this.trackingSent=true;if(this.notification_type==="normal"||this.notification_type==="normal_with_flubit"){return window.ih.reporter.trackFinalisedProductNotification(this.normalizedUrl,this.scrape.price,this.alternatives,this.product,this.relatedProducts,this.flubit_button_shown);}else if(this.notification_type==="flubit_solo"){return window.ih.reporter.trackFlubitNotification(this.normalizedUrl,this.product);}}};Notification.prototype.updateSharingArea=function(){var bestDeal;bestDeal=this.bestOverallAlternative();bestDeal.scrape=this.scrape;$('#retailer-to-share').text(notificationUtils.shortenString(bestDeal.retailer,20));$('#price-to-share').html(notificationUtils.formatPrice(bestDeal.price,notificationUtils.htmlCurrencySymbol(this.region.currency.name)));return this.sharingArea.update(bestDeal,this.region.currency.name);};Notification.prototype.awake=function(){$("#notification").addClass("ih-hits").removeClass("sleeping");return window.ih.extension.notify('awake',{topMargin:this.rootElement.outerHeight()+15});};Notification.prototype.show_pb=function(){if(this.sleep.isSleeping(this.retailer)){if(!$("#notification").hasClass("ih-hits")){window.ih.extension.notify('sleep',{});$("#notification").addClass("sleeping");}}
return this.show();};Notification.prototype.show=function(){if(this.flubit.shouldShow()&&!this.alternatives.some()){this.notification_type='flubit_solo';this.clearMessages();$('#flubit-solo-message').show();this.show_flubbit_button(true);this.awake();if(!this.shown){return this.notifyExtension();}}else if((this.alternatives.some()||this.relatedProducts.some())&&this.flubit.shouldShow()&&this.scrape.price&&this.alternatives.best().price>=this.scrape.price){this.notification_type='normal_with_flubit';this.clearMessages();$('#best-price-with-flubit-message').show();this.show_flubbit_button(true);this.awake();if(!this.shown){return this.notifyExtension();}}else if(this.alternatives.some()||this.relatedProducts.some()){this.notification_type='normal';this.show_flubbit_button(false);this.update();this.awake();if(!this.shown){this.notifyExtension();if(this.alternatives.some()){return window.ih.reporter.trackProductNotification();}else if(this.relatedProducts.some()){return window.ih.reporter.trackSimilarProductNotificationShown();}}}else if(this.coupons.some()){this.notification_type='normal';if(!this.shown){return this.notifyExtension();}}};Notification.prototype.notifyExtension=function(){var notificationHeight,topMargin;this.shown=true;notificationHeight=notificationHeight||this.rootElement.outerHeight()+15;if(this.sleep.isSleeping(this.retailer)){topMargin=0;}else{topMargin=notificationHeight;}
return window.ih.extension.notify('showNotification',{notificationHeight:notificationHeight,topMargin:topMargin});};Notification.prototype.show_flubbit_button=function(status){this.flubit_button_shown=status;return this.flubit.show_button(status);};Notification.prototype.update=function(){this.updateMessage();this.updateWishlistLink();return this.updateSharingArea();};Notification.prototype.currentProductAsAlternative=function(){return{"title":this.scrape.title,"price":this.scrape.price,"retailer":this.currentRetailerName(),"url":this.url};};Notification.prototype.currentRetailerName=function(){var match;match=this.url.match(/^https?:\/\/(?:ww[w\d]\.)?([^\/]+)/);if(!match){return this.url;}
return notificationUtils.camelCase(match[1]);};Notification.prototype.updateWishlistLink=function(){var best,deeplink,facebookLink,fb_app,proto;try{fb_app=ih_fb_app;proto='http';}catch(err){fb_app='ih-wishlist';proto='https';}
best=this.bestOverallAlternative();deeplink=this.alternatives.best().deeplink;facebookLink=proto+"://apps.facebook.com/"+fb_app+"/me/preview?";facebookLink+="title="+escape(best.title);facebookLink+="&price="+best.price;facebookLink+="&currency="+escape(notificationUtils.htmlCurrencySymbol(this.region.currency.name));facebookLink+="&deeplink="+escape(deeplink);facebookLink+="&original_price="+this.scrape.price;facebookLink=encodeURI(facebookLink);$("#wish-cell").attr("href",facebookLink);return $("body.invisiblehand #wish-cell").show();};Notification.prototype.clearMessages=function(){$("#message > div").hide();$("#flubit-solo-message").hide();$('#best-price-with-flubit-message').hide();return $('#placeholder').hide();};Notification.prototype.updateMessage=function(){var field,message,messageId,node,nodes,value,_results;message=this.message();if(!message){return;}
messageId="#"+message.type+'-message';this.clearMessages();$(messageId).show();_results=[];for(field in message){value=message[field];nodes=$('.'+field,$(messageId));if(nodes.length!==1){continue;}
node=nodes[0];if(node.tagName==='DIV'){_results.push($(node).html(value));}else if(node.tagName==='A'){$('.retailer-name',node).html(value.retailer);_results.push($(node).attr('href',ih.reporter.alternativeClickUrl(value,this.product,0)));}else{_results.push(void 0);}}
return _results;};Notification.prototype.changeIFrameHeightIfNecessary=function(type){if(this.iFrameExpansionCounter!==0){return;}
return window.ih.extension.notify(type);};Notification.prototype.expand=function(){this.changeIFrameHeightIfNecessary('expandIframe');return this.iFrameExpansionCounter++;};Notification.prototype.collapse=function(){this.iFrameExpansionCounter--;return this.changeIFrameHeightIfNecessary('collapseIframe');};Notification.prototype.close=function(){this.sleep.sleep(this.retailer,3600);$("#notification").addClass("sleeping");return window.ih.extension.notify('sleep');};Notification.prototype.noRelatedProducts=function(){return!this.relatedProducts.some();};Notification.prototype.someRelatedProducts=function(){return this.relatedProducts.some();};Notification.prototype.message=function(){if(this.alternatives.none()&&this.noRelatedProducts()){return;}
if(this.alternatives.none()&&this.someRelatedProducts()){return this.relatedProductsMessage();}
if(!this.priceScraped()){return this.alsoAvailableAtMessage();}
if(this.currentProductIsTheCheapest()){return this.bestPriceMessage();}
return this.saveMoneyMessage();};Notification.prototype.bestPriceMessage=function(){var alternative,savings;alternative=this.alternatives.best();savings=this.scrape.price-alternative.price;return{"type":'best-price',"best-price":notificationUtils.formatPrice(this.scrape.price,notificationUtils.htmlCurrencySymbol(this.region.currency.name)),"next-best":notificationUtils.formatPrice(alternative.price,notificationUtils.htmlCurrencySymbol(this.region.currency.name)),"next-best-retailer":alternative};};Notification.prototype.relatedProductsMessage=function(){return{"type":'related-products'};};Notification.prototype.saveMoneyMessage=function(){var alternative,relativeSavings,type;alternative=this.alternatives.best();relativeSavings=this.relativeSavings(alternative);type=relativeSavings>=1?'save-money':'save-pennies';return{"title":alternative.getTitle(),"type":type,"savings-relative":relativeSavings.toString()+"%","savings-absolute":notificationUtils.formatPrice(this.savings(alternative),notificationUtils.htmlCurrencySymbol(this.region.currency.name)),"cheaper-price":notificationUtils.formatPrice(alternative.price,notificationUtils.htmlCurrencySymbol(this.region.currency.name)),"cheaper-retailer":alternative};};Notification.prototype.savings=function(alternative){var altPennnies,savedPennies,scrapePennnies;if(this.scrape.price&&alternative.price){scrapePennnies=Math.round(this.scrape.price*100);altPennnies=Math.round(alternative.price*100);savedPennies=scrapePennnies-altPennnies;return savedPennies/100;}};Notification.prototype.relativeSavings=function(alternative){if(!(this.scrape.price>0)){return null;}
return Math.round((1-alternative.price/this.scrape.price)*100);};Notification.prototype.bestOverallAlternative=function(){if(this.currentProductIsTheCheapest()){return this.currentProductAsAlternative();}else{return this.alternatives.best();}};Notification.prototype.currentProductIsTheCheapest=function(){if(this.alternatives.none()){return true;}
return this.scrape.price<=this.alternatives.best().price;};Notification.prototype.priceScraped=function(){return!!this.scrape.price;};Notification.prototype.alsoAvailableAtMessage=function(){var alternative;alternative=this.alternatives.best();return{"title":alternative.getTitle(),"type":'also-available-at',"next-best":notificationUtils.formatPrice(alternative.price,notificationUtils.htmlCurrencySymbol(this.region.currency.name)),"next-best-retailer":alternative};};return Notification;})();window.Notification=Notification;}).call(this);
// 14.products_iframe.js

var eventSource;var iFrameExpansionCounter=0;var notificationTracked=false;var dataForReportingIssues={};var feedbackdialog;window.ih={}
$(document).ready(function(){$("img.logo").click(function(){if($("#notification").hasClass("sleeping")){window.ih.notification.sleep.awake(window.ih.notification.retailer);window.ih.notification.awake();}});$("#message > div").hide();$("#tabs").tabs({fx:{opacity:'toggle',duration:100}});feedbackdialog=$("#feedback-dialog").dialog({show:"fade",closeOnEscape:false,modal:true,autoOpen:false,zIndex:100010,draggable:false,width:500,height:400,closeText:""});$('#alternatives-feedback').click(function(){var focus=$('#retailers-popup');$(focus).unbind('blur');$('.drop-down').removeClass('depressed');$('.drop-down').find(".icon-chevron-up").removeClass("icon-chevron-up").addClass('icon-chevron-down');$(focus).unbind('blur');$(focus).fadeOut("fast",function(){});ih.notification.expand();feedbackdialog.dialog('open');});$('#dialogclose').click(function(){closeFeedbackDialog();});$('#dialogclosethanks').click(function(){closeFeedbackDialog();});$('#sendfeedback').click(function(){tracking_code=$('#feedback-dialog .brandcode').text();user_message=$('#feedback-dialog .feedback-dialog-notes').val().substring(0,1000);user_email=$('#feedback-dialog .user-email').val();data={tracking_code:tracking_code,alternatives:JSON.stringify(ih.notification.alternatives.toAttributes()),uid:ih.notification.uid,url:document.referrer,user_message:user_message,user_email:user_email}
$.ajax({type:'POST',url:"/report",data:data,success:displayFeedbackThanks(),dataType:"json"});});$('#feedback-dialog .feedback-dialog-notes').bind('keyup',function(){imposeMaxFieldLength(event,this,1000)});$('.drop-down').live('click',function(event){showDropDown(this);});$('#close').live('click',function(event){if(ih.reporter)ih.reporter.trackClose();ih.notification.close();});$('#retailers-content').live('click',function(){_gaq.push(['_trackEvent','alternative',"more-retailers"]);});$('.cheaper-retailer').live('click',function(){_gaq.push(['_trackEvent','alternative',"cheaper-retailer"]);});$('.next-best-retailer').live('click',function(){_gaq.push(['_trackEvent','alternative',"next-best-retailer"]);});$('.retailer-link').live('click',function(){_gaq.push(['_trackEvent','alternative',"retailer"]);});$('#more_about_this_product').live('click',function(){_gaq.push(['_trackEvent','more-about-this-product',"button-clicked"]);});$('.relateditems').live('click',function(){_gaq.push(['_trackEvent','similar-items',"more-retailers"]);});$('.relateditems-row').live('click',function(){_gaq.push(['_trackEvent','similar-items',"retailer"]);});$('.reviews').live('click',function(){_gaq.push(['_trackEvent','reviews',"top-reviews"]);});$('#all-reviews-link').live('click',function(){_gaq.push(['_trackEvent','reviews',"more-reviews"]);});$("#wish-cell").live('click',function(){_gaq.push(['_trackEvent','social','wishlist']);});$('#social').live('click',function(){_gaq.push(['_trackEvent','social','popup']);});$('#share .icons .email').live('click',function(){_gaq.push(['_trackEvent','social','share-via-email']);});$('#share .icons .twitter').live('click',function(){_gaq.push(['_trackEvent','social','share-via-twitter']);});$('#share .icons .facebook').live('click',function(){_gaq.push(['_trackEvent','social','share-via-facebook']);});$('.twitter-follow-button').live('click',function(){_gaq.push(['_trackEvent','social','follow-via-twitter']);});$('.facebook-like-button').live('click',function(){_gaq.push(['_trackEvent','social','like-via-facebook']);});$('#notification .logo').live('click',function(){_gaq.push(['_trackEvent','logo-click','logo-click']);});$('#alternatives-feedback').live('click',function(){_gaq.push(['_trackEvent','feedback-dialog','dialog-opened']);});$('#dialogclose').live('click',function(){_gaq.push(['_trackEvent','feedback-dialog','dialog-closed']);});$('#sendfeedback').live('click',function(){_gaq.push(['_trackEvent','feedback-dialog','dialog-sent']);});$('#dialogclosethanks').live('click',function(){_gaq.push(['_trackEvent','feedback-dialog','dialog-closed-after-send']);});$('#close').live('click',function(){_gaq.push(['_trackEvent','close',"clicked"]);});window.ih.extension.notify('iframeReady');$(window).unload(function(){if(window.ih.notification){window.ih.notification.sendTracking();}});});function displayFeedbackThanks(){$('#feedback-dialog .text .form').hide();$('#feedback-dialog .text .thanks').show();$('#feedback-dialog .title').hide();$('#feedback-dialog .title_thanks').show();};function closeFeedbackDialog(){feedbackdialog.dialog('close');ih.notification.collapse();};function imposeMaxFieldLength(Event,Object,MaxLen){$('#feedback-dialog .feedback-dialog-notes-chars-remaining').text(MaxLen-Object.value.length+" characters remaining.");return(Object.value.length<=MaxLen)||(Event.keyCode==8||Event.keyCode==46||(Event.keyCode>=35&&Event.keyCode<=40))};function bindInputBlur(popup,focus){$(focus).unbind('blur');$(focus).focus();$(focus).blur(function(){$('.drop-down').removeClass('depressed');$('.drop-down').find(".icon-chevron-up").removeClass("icon-chevron-up").addClass('icon-chevron-down');$(focus).unbind('blur');$(popup).fadeOut("fast",function(){ih.notification.collapse();});});}
function dropDownIsOpen(popup){return!!$('#'+popup.attr('id')+':visible').length;}
function expandPopup(root,popup){var left=(root.offset().left+root.width()/2)-(popup.width()/2);popup.css('left',left);var focus=$('.inputForFocus',popup);$(root).addClass('depressed');$(root).find(".icon-chevron-down").removeClass("icon-chevron-down").addClass('icon-chevron-up');popup.fadeIn("fast",function(){focus.focus()});prepareInput(popup,focus);}
function prepareInput(popup,focus){bindInputBlur(popup,focus);popup.hover(function(){focus.unbind('blur');},function(){bindInputBlur(popup,focus);});}
function showDropDown(clicked){var root=$(clicked);var popup=$('.popup',root.parent());if(dropDownIsOpen(popup))return;ih.notification.expand();expandPopup(root,popup);window.ih.notification.sendTracking();};